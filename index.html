<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Dart Lane Passcode</title>
<style>
  body {
    margin: 0;
    font-family: sans-serif;
    background: #0d1117;
    color: #fff;
    display: flex;
    flex-direction: column;
    justify-content: center;
    align-items: center;
    height: 100vh;
  }
  #leagueNotice {
    text-align: center;
    font-size: 1.5em;
    margin-bottom: 20px;
    display: none;
  }
  #passcodeDisplay {
    letter-spacing: 20px;
    font-size: 2em;
    margin-bottom: 20px;
  }
  #keypad {
    display: grid;
    grid-template-columns: repeat(3, 80px);
    grid-gap: 10px;
  }
  button {
    width: 80px;
    height: 80px;
    font-size: 1.5em;
    border-radius: 50%;
    border: none;
    background: #1e1e1e;
    color: #fff;
    cursor: pointer;
  }
  button:hover {
    background: #444;
  }
  #staffButton {
    margin-top: 20px;
    padding: 20px 20px;
    font-size: 1.2em;
    border-radius: 20px;
    background: #ff9800;
    color: #000;
  }
</style>
</head>
<body>

<div id="leagueNotice">
  <h2>League Play in Progress</h2>
  <p>Public play unavailable</p>
  <p>Thursday 6:00–10:00 PM</p>
</div>

<div id="passcodeSection">
  <div id="passcodeDisplay">••••</div>
  <div id="keypad">
    <button onclick="addDigit(1)">1</button>
    <button onclick="addDigit(2)">2</button>
    <button onclick="addDigit(3)">3</button>
    <button onclick="addDigit(4)">4</button>
    <button onclick="addDigit(5)">5</button>
    <button onclick="addDigit(6)">6</button>
    <button onclick="addDigit(7)">7</button>
    <button onclick="addDigit(8)">8</button>
    <button onclick="addDigit(9)">9</button>
    <button onclick="clearPasscode()">C</button>
    <button onclick="addDigit(0)">0</button>
    <button onclick="submitPasscode()">✓</button>
  </div>
</div>

<button id="staffButton" onclick="staffOverride()">Staff Override</button>

<script>
const LEAGUE_DAY = 4; // Thursday
const START_HOUR = 18;
const END_HOUR = 22;
const LANE = "Lane 1";
const CORRECT_CODE = "1234"; // Change this to your passcode

let enteredCode = "";

// --- Check league hours ---
function checkLeagueHours() {
  const now = new Date();
  const day = now.getDay();
  const hour = now.getHours();

  if (day === LEAGUE_DAY && hour >= START_HOUR && hour < END_HOUR) {
    document.getElementById("leagueNotice").style.display = "block";
    document.getElementById("passcodeSection").style.display = "none";
  } else {
    document.getElementById("leagueNotice").style.display = "none";
    document.getElementById("passcodeSection").style.display = "block";
  }
}

// --- Update passcode display ---
function updateDisplay() {
  document.getElementById("passcodeDisplay").innerText = "•".repeat(enteredCode.length);
}

// --- Keypad functions ---
function addDigit(d) {
  if (enteredCode.length < 4) {
    enteredCode += d;
    updateDisplay();
  }
}

function clearPasscode() {
  enteredCode = "";
  updateDisplay();
}

// --- Submit passcode ---
function submitPasscode() {
  if (enteredCode === CORRECT_CODE) {
    launchGranDarts(); // Replace with your actual GranDarts launch code
    logPasscodeUse(LANE, enteredCode, false);
    clearPasscode();
  } else {
    alert("Invalid Code");
    clearPasscode();
  }
}

// --- Staff override ---
function staffOverride() {
  launchGranDarts();
  logPasscodeUse(LANE, "STAFF_OVERRIDE", true);
}

// --- Logging to Google Sheets ---
function logPasscodeUse(lane, code, staff) {
  const url = "YOUR_GOOGLE_SCRIPT_WEB_APP_URL"; // Replace with your Google Apps Script URL
  const data = {
    lane: lane,
    code: code,
    staff: staff,
    timestamp: new Date().toISOString()
  };

  fetch(url, {
    method: "POST",
    body: JSON.stringify(data),
    headers: { 'Content-Type': 'application/json' }
  }).then(res => console.log("Logged:", data))
    .catch(err => console.error("Logging error:", err));
}

// --- Placeholder GranDarts launch ---
function launchGranDarts() {
  console.log("Launching GranDarts for", LANE);
  // Replace this with your Full Kiosk launch URL or Android intent
}

// --- Initialize ---
window.onload = checkLeagueHours;
</script>

</body>
</html>
